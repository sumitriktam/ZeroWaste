{%extends 'receiver/base.html' %}
<!--  -->
{%block title%}Dashboard{%endblock%}
<!--  -->
{%block extra_css_link%} {% load static %}
<link rel="stylesheet" href="{% static 'receiver/css/dashboard.css'%}" />
{% endblock %} {%block extra_css%}
<style>
  @import url("https://fonts.googleapis.com/css2?family=Lexend+Deca:wght@100..900&display=swap");

  body {
    font-family: "Lexend Deca", sans-serif;
    font-weight: normal;
    font-size: 16px;
    margin: 0;
    padding: 0;
  }

  .navbar {
    background-color: #e9e9e9;
    padding: 10px 0;
    position: sticky;
    top: 0;
    z-index: 3;
  }

  .navbar-brand {
    color: #1a1a1a;
    font-size: 20px;
    font-weight: bold;
  }

  .navbar-nav {
    border-radius: 5px;
  }

  .nav-item {
    padding-left: 15px;
    font-size: 16px;
  }

  .dropdown {
    position: fixed;
    left: 10px;
    margin-bottom: 2%;
  }

  .dropdown1 {
    position: fixed;
    left: 150px;
    margin-bottom: 2%;
    display: none;
  }

  .restaurant-card {
    width: 250px;
    height: 300px;
    margin: 20px;
    padding: 10px;
    border-radius: 10px;
    overflow: hidden;
    cursor: pointer;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    transition: box-shadow 0.3s, transform 0.3s;
    background-color: #fff;
  }

  .restaurant-card img {
    width: 100%;
    height: 53%;
    border-top-left-radius: 10px;
    border-top-right-radius: 10px;
    object-fit: cover;
  }

  .restaurant-card .card-body {
    padding: 10px;
  }

  .restaurant-card h4,
  .restaurant-card p {
    margin: 0;
    font-size: 16px;
    white-space: normal;
  }

  .restaurant-card .card-body h4 {
    font-size: 20px;
    font-weight: bold;
  }

  .restaurant-card:hover {
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
    transform: scale(1.05);
  }

  .validation-message {
    text-align: center;
    background-color: #f7a9af;
    color: #721c24;
    border-radius: 5px;
    margin-bottom: 4px;
  }

  .message-list {
    display: inline-block;
  }

  .faq {
    font-size: 18px;
    color: #333;
    position: relative;
    top:auto;
    margin-top:15%;
    bottom: 0px;
    width: 100%;
  }

  .accordion-button {
    background-color: #86b77d;
    color: #fff;
  }
</style>

{%endblock%} {%block body%} {% if messages %}
<div class="validation-message" id="validationMessage">
  <ul class="message-list">
    {% for message in messages %}
    <li>{{ message }}</li>
    {% endfor %}
  </ul>
</div>
{%endif%}
<div>
  <div class="dropdown">
    <a
      class="btn btn-secondary dropdown-toggle"
      style="background-color: #578b50"
      href="#"
      role="button"
      id="dropdownMenuLink"
      data-bs-toggle="dropdown"
      aria-expanded="false"
    >
      Categories
    </a>

    <ul class="dropdown-menu" aria-labelledby="dropdownMenuLink">
      <li>
        <a class="dropdown-item" href="#" onclick="filterPosts('all')">All</a>
      </li>
      <li><a class="dropdown-item" href="#" onclick="filterPosts('food')">Food</a></li>
      <li>
        <a class="dropdown-item" href="#" onclick="filterPosts('clothes')">Clothes</a>
      </li>
      <li>
        <a class="dropdown-item" href="#" onclick="filterPosts('toys')">Toys</a>
      </li>
      <li>
        <a class="dropdown-item" href="#" onclick="filterPosts('groceries')"
          >Groceries</a
        >
      </li>
      <li>
        <a class="dropdown-item" href="#" onclick="filterPosts('others')"
          >Others</a
        >
      </li>
    </ul>
  </div>

  <div class="dropdown1" id="subdropdown">
    <select class="form-select" id="subcategoryDropdown" style="width: 150px;" onchange="filterSubcategories()">
      <option value="" selected>Select Any Category</option>
    </select>
  </div>

  <div id="MainDropDownValue"></div>
  <div id="SubDropdownValue"></div>
</div>

<div id="post-container">
  <div
    class="restaurant-cards"
    style="display: flex; flex-wrap: wrap; margin-left: 5%"
  >
    {% for post in data.posts %}
    <div class="restaurant-card" onclick="sendRequest('{{ post.post_id }}')">
      <img src="{{ post.image }}" alt="Item Image" />
      <div class="card-body">
        <h4>{{post.item_name}}</h4>
        <p>{{post.location}}</p>
        <p>{{post.drop_pickup}}</p>
      </div>
      <form
        id="form_{{post.post_id}}"
        action="{% url 'receiver:view_post' post_id=post.post_id %}"
        method="post"
      >
        {% csrf_token %}
      </form>
    </div>
    {% endfor %}
  </div>
</div>
<div class="faq">
  <h2>FAQ'S</h2>
  <hr />
  <div class="accordion accordion-flush" id="accordionFlushExample">
    <div class="accordion-item">
      <h2 class="accordion-header" id="flush-headingOne">
        <button
          style="background-color: #86b77d"
          class="accordion-button collapsed"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#flush-collapseOne"
          aria-expanded="false"
          aria-controls="flush-collapseOne"
        >
          What are drop and pickup?
        </button>
      </h2>
      <div
        id="flush-collapseOne"
        class="accordion-collapse collapse"
        aria-labelledby="flush-headingOne"
        data-bs-parent="#accordionFlushExample"
      >
        <div class="accordion-body">
          Pickup and drop are simple ways for people to get donated items to
          those who need them. In post if pickup is mentioned then you go to the
          provider's place to collect the items. On the other hand, with drop,
          the provider brings the items directly to you.
        </div>
      </div>
    </div>
    <div class="accordion-item">
      <h2 class="accordion-header" id="flush-headingTwo">
        <button
          class="accordion-button collapsed"
          style="background-color: #86b77d"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#flush-collapseTwo"
          aria-expanded="false"
          aria-controls="flush-collapseTwo"
        >
          What's the next step after I order an item?
        </button>
      </h2>
      <div
        id="flush-collapseTwo"
        class="accordion-collapse collapse"
        aria-labelledby="flush-headingTwo"
        data-bs-parent="#accordionFlushExample"
      >
        <div class="accordion-body">
          After you've placed an order for an item, the provider will review it
          and decide whether to approve it or not. This ensures the availability
          of the item. Once approved, you can track the status of your order in
          the 'Active Orders' section of your history page.
        </div>
      </div>
    </div>
  </div>
</div>
{%endblock%} {%block extra_js%}

<script>
   <!-- js -->
   function sendRequest(postId) {
   const form=document.getElementById(`form_${postId}`); form.action =
   `/receiver/view_post/${postId}/`;
   document.getElementById("form_" +postId).submit();
  }

  function filteritems(posts , category , subcategory){
    console.log(category , subcategory )
      if(category=="food" || category=="groceries"){
        today  = new Date();
          console.log(category , subcategory)
        if(subcategory=="Expired"){
          time = today.getTime();
          
          return posts.filter((post)=>post.category==category && today > new Date(`${post.expiry_date}T${post.expiry_time}`));
        }
        else if(subcategory=="Not Expired"){
          return posts.filter((post)=>post.category==category && today <= new Date(`${post.expiry_date}T${post.expiry_time}`));
        }
        else{
          return posts.filter((post)=>post.category==category);
        }
      }
      else if(category=="clothes"){
        
        return posts.filter((post)=>post.category==category);
      }
  }


   function filterPosts(category , subcategory=null){
    let MainDropDownValue = document.getElementById("MainDropDownValue");
    MainDropDownValue.value = category;
    console.log(category);
filterSubcategories(MainDropDownValue.value);
   let all_posts = {{data.posts | safe }};

   console.log(all_posts);
   
   //filteredPosts=all_posts.filter((post)=>post.category===category)

   filteredPosts = filteritems(all_posts , category , subcategory);
   if(category==='all')filteredPosts=all_posts
   document.querySelector('.restaurant-cards').innerHTML=''
   if(filteredPosts.length===0)document.querySelector('.restaurant-cards').innerHTML="<h2>Sorry no posts available</h2>"
   filteredPosts.forEach(function(post) { let postElement =
   document.createElement('div'); postElement.className = 'restaurant-card';
   postElement.onclick = function() { sendRequest(post.post_id); };
   postElement.innerHTML = `
   <img src="${post.image}" alt="Item Image" />
   <div class="card-body">
     <h4>${post.item_name}</h4>
     <p>${post.location}</p>
     <p>${post.drop_pickup}</p>
   </div>
   <form id="form_${post.post_id}" action="" method="post">{% csrf_token %}</form>
   `; // Append the post container to "restaurent-cards" class
   document.querySelector('.restaurant-cards').appendChild(postElement); }); 
  }


 

  function filterSubcategories() {
    const category = document.getElementById('MainDropDownValue').value;
    const subcategoryDropdown = document.getElementById('subcategoryDropdown');
    const selectedSubcategory = subcategoryDropdown.value;

    
    console.log(category);
    if (category === 'food' || category === 'groceries') {
      const foodOptions = ['Expired', 'Not Expired'];
      populateDropdown(category , subcategoryDropdown, foodOptions, selectedSubcategory);
      subdropdown.style.display = 'block';

    } else if (category === 'clothes') {
      const clothesOptions = ['Size XL', 'Size L', 'Size S'];
      populateDropdown(category , subcategoryDropdown, clothesOptions, selectedSubcategory);
      subdropdown.style.display = 'none';

    } else {
      subcategoryDropdown.innerHTML = '';
      subdropdown.style.display = 'none';

    }
  }

  function populateDropdown(category  ,dropdown, options, selectedOption) {
    dropdown.innerHTML = '';
    options.forEach(option => {
      const optionElement = document.createElement('option');
      optionElement.value = option;
      optionElement.innerText = option;
      dropdown.appendChild(optionElement);
    });
    dropdown.value = selectedOption;
    dropdown.onchange = function() {
      filterPosts(category, dropdown.value);
    };
  }
  
  


  filterSubcategories();


</script>
{%endblock%}
